<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Personal Calendar</title>
    <style>
        :root { 
            --primary: #2563eb; --bg: #f8fafc; --surface: #ffffff; 
            --border: #e2e8f0; --text: #1e293b; --text-muted: #64748b;
            --today: #f59e0b; --weekend-bg: #fff1f2; --weekend-text: #e11d48;
        }

        /* The "Secret Sauce" for Mobile Clicks */
        body { 
            -webkit-tap-highlight-color: transparent;
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg); color: var(--text); padding: 15px; 
            max-width: 1300px; margin: 0 auto; 
        }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .status-badge { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; background: #dcfce7; color: #166534; }
        
        button, .day { cursor: pointer !important; touch-action: manipulation; }

        .calendar-wrapper { 
            background: var(--surface); border: 1px solid var(--border); 
            border-radius: 12px; padding: 15px; margin-bottom: 30px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }

        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .delete-btn { background: #ef4444; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 0.7rem; }

        .months-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .month { border: 1px solid var(--border); border-radius: 8px; padding: 10px; background: white; }
        .month-name { text-align: center; font-weight: bold; margin-bottom: 10px; }
        
        .weekday-headers, .days-grid { display: grid; grid-template-columns: 28px repeat(7, 1fr); gap: 2px; }
        .weekday-headers { margin-bottom: 5px; text-align: center; font-size: 0.65rem; font-weight: bold; color: var(--text-muted); }
        
        .day { 
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center; 
            font-size: 0.8rem; border-radius: 4px; border: 2px solid transparent;
        }
        
        /* Week Numbers */
        .day.week-num { cursor: default !important; font-size: 0.6rem; color: #94a3b8; background: #f8fafc; border-right: 1px solid var(--border); }
        
        .day.weekend { background-color: var(--weekend-bg); color: var(--weekend-text); }
        .day.is-today { border-color: var(--today); font-weight: bold; color: var(--today); }
        .day.marked { background-color: var(--primary) !important; color: white !important; font-weight: bold; }
        .day.empty { pointer-events: none; }
    </style>
</head>
<body onclick="void(0)">

    <header>
        <h2 style="margin:0; font-size: 1.2rem;">2026 Tracker</h2>
        <div style="display:flex; align-items:center; gap:10px;">
            <span id="sync-status" class="status-badge">Synced</span>
            <button onclick="addNewCalendar()" style="background:#2563eb; color:white; border:none; padding:8px 12px; border-radius:6px; font-weight:bold;">+ New</button>
        </div>
    </header>

    <div id="app"></div>

    <script>
        const DB_URL = "https://calendar-3ce3a-default-rtdb.europe-west1.firebasedatabase.app/calendars.json";
        let calendars = [];

        async function loadData() {
            try {
                const r = await fetch(DB_URL);
                const data = await r.json();
                calendars = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
                render();
            } catch (e) { document.getElementById('sync-status').innerText = "Offline"; }
        }

        async function saveData() {
            document.getElementById('sync-status').innerText = "Saving...";
            await fetch(DB_URL, { method: 'PUT', body: JSON.stringify(calendars) });
            document.getElementById('sync-status').innerText = "Synced";
        }

        function toggle(calId, m, d) {
            const cal = calendars.find(c => c.id === calId);
            const key = `${m}-${d}`;
            if (!cal.marks) cal.marks = [];
            cal.marks.includes(key) ? cal.marks = cal.marks.filter(x => x !== key) : cal.marks.push(key);
            render();
            saveData();
        }

        function deleteCal(id) {
            if(confirm("Delete calendar?")) { calendars = calendars.filter(c => c.id !== id); render(); saveData(); }
        }

        function addNewCalendar() {
            const name = prompt("Name:");
            if(name) { calendars.push({id: Date.now(), name, marks: []}); render(); saveData(); }
        }

        function getWk(d) {
            let t = new Date(d.getTime()); t.setHours(0,0,0,0);
            t.setDate(t.getDate() + 3 - (t.getDay() + 6) % 7);
            let w1 = new Date(t.getFullYear(), 0, 4);
            return 1 + Math.round(((t - w1)/86400000 - 3 + (w1.getDay() + 6)%7)/7);
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = '';
            
            calendars.forEach(cal => {
                const wrap = document.createElement('div');
                wrap.className = 'calendar-wrapper';
                wrap.innerHTML = `<div class="cal-header">
                    <strong>${cal.name}</strong>
                    <div><small>Total: ${cal.marks?.length || 0}</small> 
                    <button class="delete-btn" onclick="deleteCal(${cal.id})">Delete</button></div>
                </div>`;

                const mGrid = document.createElement('div');
                mGrid.className = 'months-grid';

                for (let m = 0; m < 12; m++) {
                    const mDiv = document.createElement('div');
                    mDiv.className = 'month';
                    mDiv.innerHTML = `<div class="month-name">${['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][m]}</div>
                        <div class="weekday-headers"><div>Wk</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div style="color:red">S</div><div style="color:red">S</div></div>`;
                    
                    const dGrid = document.createElement('div');
                    dGrid.className = 'days-grid';
                    
                    const first = new Date(2026, m, 1);
                    const last = new Date(2026, m + 1, 0).getDate();
                    let startIdx = first.getDay() === 0 ? 6 : first.getDay() - 1;
                    
                    let day = 1;
                    for (let r = 0; r < 6; r++) {
                        if (day > last) break;
                        dGrid.innerHTML += `<div class="day week-num">${getWk(new Date(2026, m, day))}</div>`;
                        for (let c = 0; c < 7; c++) {
                            const pos = r * 7 + c;
                            if (pos < startIdx || day > last) {
                                dGrid.innerHTML += `<div class="day empty"></div>`;
                            } else {
                                const d = day;
                                const isX = cal.marks?.includes(`${m}-${d}`);
                                const today = (d === new Date().getDate() && m === new Date().getMonth());
                                
                                const dEl = document.createElement('div');
                                dEl.className = `day ${isX ? 'marked' : ''} ${c >= 5 ? 'weekend' : ''} ${today ? 'is-today' : ''}`;
                                dEl.setAttribute('role', 'button');
                                dEl.innerText = isX ? 'X' : d;
                                dEl.onclick = () => toggle(cal.id, m, d);
                                dGrid.appendChild(dEl);
                                day++;
                            }
                        }
                    }
                    mDiv.appendChild(dGrid);
                    mGrid.appendChild(mDiv);
                }
                wrap.appendChild(mGrid);
                app.appendChild(wrap);
            });
        }
        loadData();
    </script>
</body>
</html>