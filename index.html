<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 Personal Tracker</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --surface: #ffffff; --border: #e2e8f0; --text: #1e293b; --today: #f59e0b; --weekend-bg: #fff1f2; --weekend-text: #e11d48; }
        body { -webkit-tap-highlight-color: transparent; font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
        .status { font-size: 0.7rem; color: #166534; background: #dcfce7; padding: 4px 8px; border-radius: 10px; }
        button { cursor: pointer; background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: bold; }
        .calendar-wrapper { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 30px; }
        .months-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .month { border: 1px solid var(--border); border-radius: 8px; padding: 10px; }
        .month-name { text-align: center; font-weight: bold; margin-bottom: 10px; }
        .weekday-headers, .days-grid { display: grid; grid-template-columns: 30px repeat(7, 1fr); gap: 2px; }
        .weekday-headers { font-size: 0.6rem; color: #64748b; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; border-radius: 4px; cursor: pointer; border: 2px solid transparent; }
        .day.week-num { cursor: default; background: #f1f5f9; color: #94a3b8; font-size: 0.6rem; border-right: 1px solid var(--border); }
        .day.weekend { background: var(--weekend-bg); color: var(--weekend-text); }
        .day.is-today { border-color: var(--today); color: var(--today); font-weight: bold; }
        .day.marked { background: var(--primary) !important; color: white !important; font-weight: bold; }
        .day.empty { pointer-events: none; }
    </style>
</head>
<body onclick="void(0)">

    <header>
        <h3 style="margin:0">2026 Personal Tracker</h3>
        <div style="display:flex; align-items:center; gap:10px">
            <span id="sync-status" class="status">Synced</span>
            <button onclick="addCalendar()">+ New</button>
        </div>
    </header>

    <div id="app"></div>

    <script>
        const DB_URL = "https://calendar-3ce3a-default-rtdb.europe-west1.firebasedatabase.app/calendars.json";
        let calendars = [];

        async function loadData() {
            try {
                const r = await fetch(DB_URL);
                const data = await r.json();
                // Handle Firebase returning an object or an array
                if (!data) calendars = [];
                else if (Array.isArray(data)) calendars = data.filter(i => i !== null);
                else calendars = Object.values(data);
                render();
            } catch (e) { console.error("Load error:", e); }
        }

        async function saveData() {
            document.getElementById('sync-status').innerText = "Saving...";
            try {
                await fetch(DB_URL, { method: 'PUT', body: JSON.stringify(calendars) });
                document.getElementById('sync-status').innerText = "Synced";
            } catch (e) { document.getElementById('sync-status').innerText = "Error"; }
        }

        function toggle(calId, m, d) {
            const cal = calendars.find(c => c.id === calId);
            if (!cal) return;
            const key = `${m}-${d}`;
            if (!cal.marks) cal.marks = [];
            cal.marks.includes(key) ? cal.marks = cal.marks.filter(x => x !== key) : cal.marks.push(key);
            render();
            saveData();
        }

        function addCalendar() {
            const name = prompt("Calendar Name:");
            if (name) {
                calendars.push({ id: Date.now(), name: name, marks: [] });
                render();
                saveData();
            }
        }

        function getWk(date) {
            let t = new Date(date.getTime()); t.setHours(0,0,0,0);
            t.setDate(t.getDate() + 3 - (t.getDay() + 6) % 7);
            let w1 = new Date(t.getFullYear(), 0, 4);
            return 1 + Math.round(((t - w1)/86400000 - 3 + (w1.getDay() + 6)%7)/7);
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = '';
            
            calendars.forEach(cal => {
                const wrap = document.createElement('div');
                wrap.className = 'calendar-wrapper';
                wrap.innerHTML = `<div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #e2e8f0; padding-bottom:10px">
                    <strong>${cal.name}</strong>
                    <button onclick="deleteCal(${cal.id})" style="background:#ef4444; padding:4px 8px; font-size:0.7rem">Delete</button>
                </div>`;

                const mGrid = document.createElement('div');
                mGrid.className = 'months-grid';

                for (let m = 0; m < 12; m++) {
                    const mDiv = document.createElement('div');
                    mDiv.className = 'month';
                    mDiv.innerHTML = `<div class="month-name">${['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][m]}</div>
                        <div class="weekday-headers"><div>Wk</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div style="color:red">S</div><div style="color:red">S</div></div>`;
                    
                    const dGrid = document.createElement('div');
                    dGrid.className = 'days-grid';
                    
                    const first = new Date(2026, m, 1);
                    const last = new Date(2026, m + 1, 0).getDate();
                    let startIdx = first.getDay() === 0 ? 6 : first.getDay() - 1;
                    
                    let day = 1;
                    for (let r = 0; r < 6; r++) {
                        if (day > last) break;
                        dGrid.innerHTML += `<div class="day week-num">${getWk(new Date(2026, m, day))}</div>`;
                        for (let c = 0; c < 7; c++) {
                            const pos = r * 7 + c;
                            if (pos < startIdx || day > last) {
                                dGrid.innerHTML += `<div class="day empty"></div>`;
                            } else {
                                const d = day;
                                const isX = cal.marks && cal.marks.includes(`${m}-${d}`);
                                const today = (d === new Date().getDate() && m === new Date().getMonth());
                                
                                const dEl = document.createElement('div');
                                dEl.className = `day ${isX ? 'marked' : ''} ${c >= 5 ? 'weekend' : ''} ${today ? 'is-today' : ''}`;
                                dEl.innerText = isX ? 'X' : d;
                                // DIRECT ASSIGNMENT IS MORE RELIABLE FOR MOBILE
                                dEl.onclick = function() { toggle(cal.id, m, d); };
                                dGrid.appendChild(dEl);
                                day++;
                            }
                        }
                    }
                    mDiv.appendChild(dGrid);
                    mGrid.appendChild(mDiv);
                }
                wrap.appendChild(mGrid);
                app.appendChild(wrap);
            });
        }

        function deleteCal(id) {
            if(confirm("Delete?")) { calendars = calendars.filter(c => c.id !== id); render(); saveData(); }
        }

        loadData();
    </script>
</body>
</html>